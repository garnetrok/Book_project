<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œ ìƒì„¸ì •ë³´</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .book-details {
            background-color: white;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
        }
        .book-image-container {
            flex: 0 0 200px;
            margin-right: 20px;
            margin-bottom: 20px;
        }
        .book-info {
            flex: 1;
            min-width: 300px;
        }
        .book-image {
            width: 100%;
            height: 300px;
            object-fit: contain;
            background-color: #f0f0f0;
        }
        #reviews {
            margin-top: 20px;
        }
        #reviewForm {
            margin-top: 20px;
        }
        .stars {
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-end;
            gap: 5px;
            margin-bottom: 10px;
        }
        .stars input {
            display: none;
        }
        .stars label {
            font-size: 25px;
            color: #ddd;
            cursor: pointer;
        }
        .stars label:hover,
        .stars label:hover ~ label,
        .stars input:checked ~ label {
            color: gold;
        }

        /* ìˆ˜ì •ëœ ë¦¬ë·° ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .review-item {
            border: 1px solid #e0e0e0;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .review-info {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0; /* ì´ ì¤„ì„ ì¶”ê°€í•˜ì—¬ flexbox ë‚´ë¶€ì—ì„œ ì¶•ì†Œ ê°€ëŠ¥í•˜ê²Œ í•¨ */
            flex: 1;
        }
        .review-rating, .review-name, .review-date {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .review-name {
            flex: 0 1 auto; /* ì´ë¦„ì´ ë„ˆë¬´ ê¸¸ ê²½ìš° ì¤„ì„ */
        }
        .review-date {
            flex: 0 1 auto; /* ë‚ ì§œê°€ ë„ˆë¬´ ê¸¸ ê²½ìš° ì¤„ì„ */
        }
        .review-content {
            margin-top: 5px;
            word-break: break-word; /* ê¸´ ë‹¨ì–´ë„ ì¤„ë°”ê¿ˆ */
        }
        .like-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            white-space: nowrap; /* ë²„íŠ¼ í…ìŠ¤íŠ¸ê°€ ì¤„ë°”ê¿ˆë˜ì§€ ì•Šë„ë¡ í•¨ */
            flex-shrink: 0; /* ë²„íŠ¼ì´ ì¶•ì†Œë˜ì§€ ì•Šë„ë¡ í•¨ */
        }
        .like-count {
            margin-left: 5px;
            font-size: 14px;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ ê°œì„  */
        @media (max-width: 768px) {
            .book-details {
                flex-direction: column;
            }
            .book-image-container {
                flex: 0 0 100%;
                margin-right: 0;
            }
            .book-image {
                height: auto;
                max-height: 300px;
            }
            .review-info {
                flex-wrap: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
                overflow: hidden; /* ë„˜ì¹˜ëŠ” ë‚´ìš© ìˆ¨ê¹€ */
            }
            .review-date {
                display: none; /* ë§¤ìš° ì‘ì€ í™”ë©´ì—ì„œëŠ” ë‚ ì§œ ìˆ¨ê¹€ */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ë„ì„œ ìƒì„¸ì •ë³´</h1>
        <div id="bookDetails" class="book-details"></div>
        <div id="reviewForm">
            <h3>í•œì¤„ ë¦¬ë·° ì‘ì„±</h3>
            <div class="stars">
                <input type="radio" name="star" id="star5" value="5"><label for="star5">â˜…</label>
                <input type="radio" name="star" id="star4" value="4"><label for="star4">â˜…</label>
                <input type="radio" name="star" id="star3" value="3"><label for="star3">â˜…</label>
                <input type="radio" name="star" id="star2" value="2"><label for="star2">â˜…</label>
                <input type="radio" name="star" id="star1" value="1"><label for="star1">â˜…</label>
            </div>
            <input type="text" id="reviewerName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”...">
            <input type="text" id="reviewInput" placeholder="ë¦¬ë·°ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
            <button onclick="addReview()">ë¦¬ë·° ë“±ë¡</button>
        </div>
        <div id="reviews"></div>
    </div>
    <script>
        let book;
        let reviews = [];

        async function loadBookDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const bookId = urlParams.get('id');
            
            const response = await fetch('book.json');
            const books = await response.json();
            book = books.find(b => b.id === parseInt(bookId));
            
            if (book) {
                displayBookDetails();
            } else {
                document.getElementById('bookDetails').innerHTML = 'ë„ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            }
        }

        function displayBookDetails() {
            const detailsElement = document.getElementById('bookDetails');
            detailsElement.innerHTML = `
                <div class="book-image-container">
                    <img src="${book.coverImage}" alt="${book.title}" onerror="this.src='images/placeholder.png'" class="book-image">
                </div>
                <div class="book-info">
                    <h2>${book.title}</h2>
                    <p><strong>ì €ì:</strong> ${book.author}</p>
                    <p><strong>ì¶œíŒì‚¬:</strong> ${book.publisher}</p>
                    <p><strong>ì¶œíŒë…„ë„:</strong> ${book.publishYear}</p>
                    <p><strong>ì¹´í…Œê³ ë¦¬:</strong> ${book.category}</p>
                    <p><strong>ë„ì„œ ì†Œê°œ:</strong> ${book.description}</p>
                </div>
            `;
        }

        function addReview() {
            const reviewerName = document.getElementById('reviewerName').value.trim();
            const reviewInput = document.getElementById('reviewInput').value.trim();
            const starRating = document.querySelector('input[name="star"]:checked');

            if (reviewerName && reviewInput && starRating) {
                const rating = parseInt(starRating.value);
                const newReview = {
                    name: reviewerName,
                    content: reviewInput,
                    rating: rating,
                    likes: 0,
                    date: new Date().toISOString()
                };
                reviews.push(newReview);
                displayReviews();
                document.getElementById('reviewerName').value = '';
                document.getElementById('reviewInput').value = '';
                starRating.checked = false;
            } else {
                alert('ì´ë¦„, ë¦¬ë·° ë‚´ìš©, ë³„ì ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        function displayReviews() {
            const reviewsElement = document.getElementById('reviews');
            reviewsElement.innerHTML = '<h3>í•œì¤„ ë¦¬ë·°</h3>';
            reviews.forEach((review, index) => {
                const reviewElement = document.createElement('div');
                reviewElement.className = 'review-item';
                reviewElement.innerHTML = `
                    <div class="review-header">
                        <div class="review-info">
                            <span class="review-rating">${'â˜…'.repeat(review.rating)}</span>
                            <span class="review-name">${review.name}</span>
                            <span class="review-date">${new Date(review.date).toLocaleString()}</span>
                        </div>
                        <button class="like-button" onclick="likeReview(${index})">ğŸ‘ <span class="like-count">${review.likes}</span></button>
                    </div>
                    <p class="review-content">${review.content}</p>
                `;
                reviewsElement.appendChild(reviewElement);
            });
        }

        function likeReview(index) {
            reviews[index].likes++;
            displayReviews();
        }

        document.getElementById('reviewInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                addReview();
            }
        });

        loadBookDetails();
    </script>
</body>
</html>